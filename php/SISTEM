INSERT INTO public.roles (
    id_rol,
    descripcion_rol,
    accesos_rol,
    creado_rol,
    fecha_rol
) VALUES (
    1,
    'Administrador',
    ARRAY['*'],     -- Acceso total
    CURRENT_DATE,
    CURRENT_DATE
);

INSERT INTO public.usuario (
    id_usu,
    nombre_usu,
    clave_usu,
    estado_usu,
    fecha_creado_usu,
    fecha_actualiza_usu,
    id_rol
) VALUES (
    1,
    'carvallo',
    '1234',  -- admin
    1,
    CURRENT_DATE,
    CURRENT_DATE,
    1
);



--
-- PostgreSQL database dump
--

-- Dumped from database version 17.2
-- Dumped by pg_dump version 17.2

-- Started on 2025-12-09 13:55:34

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 256 (class 1255 OID 66838)
-- Name: disminuir_stock(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.disminuir_stock() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  UPDATE producto
     SET cantidad_uni_pro = COALESCE(cantidad_uni_pro,0) - COALESCE(NEW.cantidad,0)
   WHERE id_pro = NEW.id_pro;
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.disminuir_stock() OWNER TO postgres;

--
-- TOC entry 255 (class 1255 OID 42156)
-- Name: venta_recalc_total(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.venta_recalc_total() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  UPDATE public.venta v
     SET total = COALESCE((SELECT ROUND(SUM(subtotal),2) FROM public.venta_detalle WHERE id_venta = v.id_venta), 0)
   WHERE v.id_venta = COALESCE(NEW.id_venta, OLD.id_venta);
  RETURN NULL;
END;
$$;


ALTER FUNCTION public.venta_recalc_total() OWNER TO postgres;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 218 (class 1259 OID 33711)
-- Name: cargo; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.cargo (
    id_cargo integer NOT NULL,
    nombre_cargo character varying(100) NOT NULL
);


ALTER TABLE public.cargo OWNER TO postgres;

--
-- TOC entry 217 (class 1259 OID 33710)
-- Name: cargo_id_cargo_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.cargo_id_cargo_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.cargo_id_cargo_seq OWNER TO postgres;

--
-- TOC entry 5135 (class 0 OID 0)
-- Dependencies: 217
-- Name: cargo_id_cargo_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.cargo_id_cargo_seq OWNED BY public.cargo.id_cargo;


--
-- TOC entry 220 (class 1259 OID 33718)
-- Name: categoria; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.categoria (
    id_cat integer NOT NULL,
    nombre_cat character varying(100) NOT NULL
);


ALTER TABLE public.categoria OWNER TO postgres;

--
-- TOC entry 219 (class 1259 OID 33717)
-- Name: categoria_id_cat_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.categoria_id_cat_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.categoria_id_cat_seq OWNER TO postgres;

--
-- TOC entry 5136 (class 0 OID 0)
-- Dependencies: 219
-- Name: categoria_id_cat_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.categoria_id_cat_seq OWNED BY public.categoria.id_cat;


--
-- TOC entry 236 (class 1259 OID 33799)
-- Name: compra; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.compra (
    id_com integer NOT NULL,
    fecha_com date NOT NULL,
    id_proveedor integer NOT NULL,
    id_mon integer NOT NULL,
    timbrado_com character varying(20) NOT NULL,
    documento_com character varying(50) NOT NULL,
    fecha_emision_comp date NOT NULL,
    historico_com text,
    valor_documento_com numeric(14,2) NOT NULL
);


ALTER TABLE public.compra OWNER TO postgres;

--
-- TOC entry 238 (class 1259 OID 33818)
-- Name: compra_detalle; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.compra_detalle (
    id_comp_det integer NOT NULL,
    subtotal_comp_det numeric(14,2) NOT NULL,
    id_com integer NOT NULL,
    id_pro integer NOT NULL
);


ALTER TABLE public.compra_detalle OWNER TO postgres;

--
-- TOC entry 237 (class 1259 OID 33817)
-- Name: compra_detalle_id_comp_det_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.compra_detalle_id_comp_det_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.compra_detalle_id_comp_det_seq OWNER TO postgres;

--
-- TOC entry 5137 (class 0 OID 0)
-- Dependencies: 237
-- Name: compra_detalle_id_comp_det_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.compra_detalle_id_comp_det_seq OWNED BY public.compra_detalle.id_comp_det;


--
-- TOC entry 235 (class 1259 OID 33798)
-- Name: compra_id_com_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.compra_id_com_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.compra_id_com_seq OWNER TO postgres;

--
-- TOC entry 5138 (class 0 OID 0)
-- Dependencies: 235
-- Name: compra_id_com_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.compra_id_com_seq OWNED BY public.compra.id_com;


--
-- TOC entry 250 (class 1259 OID 83152)
-- Name: factura_numero_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.factura_numero_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 20;


ALTER SEQUENCE public.factura_numero_seq OWNER TO postgres;

--
-- TOC entry 254 (class 1259 OID 83173)
-- Name: factura; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.factura (
    id_factura bigint NOT NULL,
    id_venta bigint NOT NULL,
    numero bigint DEFAULT nextval('public.factura_numero_seq'::regclass) NOT NULL,
    fecha timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.factura OWNER TO postgres;

--
-- TOC entry 253 (class 1259 OID 83172)
-- Name: factura_id_factura_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.factura_id_factura_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.factura_id_factura_seq OWNER TO postgres;

--
-- TOC entry 5139 (class 0 OID 0)
-- Dependencies: 253
-- Name: factura_id_factura_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.factura_id_factura_seq OWNED BY public.factura.id_factura;


--
-- TOC entry 224 (class 1259 OID 33738)
-- Name: moneda; Type: TABLE; Schema: public; Owner: postgres
--
-- =========================================================
-- 1) NUEVA TABLA: historial de cotizaciones (versionado)
-- =========================================================

CREATE TABLE IF NOT EXISTS public.moneda (
  id_mon         BIGSERIAL PRIMARY KEY,
  guarani        NUMERIC(14,4) NOT NULL DEFAULT 1.0000,   -- normalmente base
  real           NUMERIC(14,4) NOT NULL,
  dolar          NUMERIC(14,4) NOT NULL,
  estado         VARCHAR(10) NOT NULL DEFAULT 'ACTIVO' CHECK (estado IN ('ACTIVO','INACTIVO')),
  fecha_inicio   TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  fecha_fin      TIMESTAMPTZ NULL,
  creado_en      TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- =========================================================
-- 2) GARANTÍA: SOLO 1 ACTIVA A LA VEZ
--    (índice único parcial)
-- =========================================================
CREATE UNIQUE INDEX IF NOT EXISTS ux_moneda_activa
ON public.moneda ((1))
WHERE estado = 'ACTIVO';

-- =========================================================
-- 3) TRIGGER: al INSERT, cerrar la activa anterior automáticamente
-- =========================================================
CREATE OR REPLACE FUNCTION public.fn_moneda_activar_nueva()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
BEGIN
  -- Fuerza comportamiento: nueva fila SIEMPRE entra como activa
  NEW.estado := 'ACTIVO';
  NEW.fecha_inicio := COALESCE(NEW.fecha_inicio, NOW());
  NEW.fecha_fin := NULL;

  -- Cierra cualquier activa anterior
  UPDATE public.moneda
     SET estado = 'INACTIVO',
         fecha_fin = NOW()
   WHERE estado = 'ACTIVO';

  RETURN NEW;
END;
$$;

DROP TRIGGER IF EXISTS trg_moneda_activar_nueva ON public.moneda;

CREATE TRIGGER trg_moneda_activar_nueva
BEFORE INSERT ON public.moneda
FOR EACH ROW
EXECUTE FUNCTION public.fn_moneda_activar_nueva();

-- =========================================================
-- 4) VIEW ÚTIL: la cotización vigente (la activa)
-- =========================================================
CREATE OR REPLACE VIEW public.vw_moneda_vigente AS
SELECT *
FROM public.moneda
WHERE estado = 'ACTIVO'
ORDER BY fecha_inicio DESC
LIMIT 1;

-- =========================================================
-- 5) (OPCIONAL) MIGRACIÓN desde tu tabla actual "moneda"
--    Si ya tenés datos en public.moneda (id_mon, nombre_mon, tasa_cambio)
--    y querés guardar al menos un "baseline", podés insertar una fila.
--    (Esto es solo ejemplo; lo afinamos con tu estructura real)
-- =========================================================
-- INSERT INTO public.moneda_cambio (guarani, real, dolar)
-- VALUES (1.0000, 0.0000, 0.0000);

/*CREATE TABLE public.moneda (
    id_mon integer NOT NULL,
    nombre_mon character varying(50) NOT NULL,
    tasa_cambio numeric(14,4) NOT NULL
);


ALTER TABLE public.moneda OWNER TO postgres;

--
-- TOC entry 223 (class 1259 OID 33737)
-- Name: moneda_id_mon_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.moneda_id_mon_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.moneda_id_mon_seq OWNER TO postgres;

--
-- TOC entry 5140 (class 0 OID 0)
-- Dependencies: 223
-- Name: moneda_id_mon_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.moneda_id_mon_seq OWNED BY public.moneda.id_mon;*/


--
-- TOC entry 242 (class 1259 OID 42128)
-- Name: pago_venta; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.pago_venta (
    id_pago integer NOT NULL,
    id_venta integer NOT NULL,
    id_mon integer NOT NULL,
    monto numeric(14,2) NOT NULL,
    tasa_cambio numeric(14,4) NOT NULL,
    fecha timestamp without time zone DEFAULT now() NOT NULL,
    medio character varying(30) DEFAULT 'EFECTIVO'::character varying,
    CONSTRAINT pago_venta_monto_check CHECK ((monto >= (0)::numeric))
);


ALTER TABLE public.pago_venta OWNER TO postgres;

--
-- TOC entry 241 (class 1259 OID 42127)
-- Name: pago_venta_id_pago_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.pago_venta_id_pago_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.pago_venta_id_pago_seq OWNER TO postgres;

--
-- TOC entry 5141 (class 0 OID 0)
-- Dependencies: 241
-- Name: pago_venta_id_pago_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.pago_venta_id_pago_seq OWNED BY public.pago_venta.id_pago;


--
-- TOC entry 226 (class 1259 OID 33745)
-- Name: persona; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.persona (
    id_per integer NOT NULL,
    nombre_per character varying(100) NOT NULL,
    cedula_per character varying(20) NOT NULL,
    direccion text,
    telefono text,
    correo text
);


ALTER TABLE public.persona OWNER TO postgres;

--
-- TOC entry 225 (class 1259 OID 33744)
-- Name: persona_id_per_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.persona_id_per_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.persona_id_per_seq OWNER TO postgres;

--
-- TOC entry 5142 (class 0 OID 0)
-- Dependencies: 225
-- Name: persona_id_per_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.persona_id_per_seq OWNED BY public.persona.id_per;


--
-- TOC entry 234 (class 1259 OID 33783)
-- Name: producto; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.producto (
    id_pro integer NOT NULL,
    nombre_pro character varying(100) NOT NULL,
    codigo_barra_pro character varying(50) NOT NULL,
    uni_caja_pro integer NOT NULL,
    iva_pro numeric(5,2) NOT NULL,
    id_cat integer NOT NULL,
    favorito boolean DEFAULT false,
    imagen_pro text,
    CONSTRAINT producto_iva_pro_check CHECK ((iva_pro >= (0)::numeric)),
    CONSTRAINT producto_uni_caja_pro_check CHECK ((uni_caja_pro > 0))
);


ALTER TABLE public.producto OWNER TO postgres;

--
-- TOC entry 233 (class 1259 OID 33782)
-- Name: producto_id_pro_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.producto_id_pro_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.producto_id_pro_seq OWNER TO postgres;

--
-- TOC entry 5143 (class 0 OID 0)
-- Dependencies: 233
-- Name: producto_id_pro_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.producto_id_pro_seq OWNED BY public.producto.id_pro;


--
-- TOC entry 240 (class 1259 OID 33835)
-- Name: productodetalle; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.productodetalle (
    id_det_pro integer NOT NULL,
    id_pro integer NOT NULL,
    id_com integer NOT NULL,
    codigo_barra_pro character varying(50) NOT NULL,
    cantidad_caja_pro integer NOT NULL,
    cantidad_uni_pro integer NOT NULL,
    costo_caja_pro numeric(14,2) NOT NULL,
    costo_uni_pro numeric(14,4) NOT NULL,
    precio1_pro numeric(14,2),
    precio2_pro numeric(14,2),
    precio3_pro numeric(14,2),
    uni_caja_pro integer NOT NULL,
    fecha_ven_pro date,
    porcen_pro numeric(5,2),
    CONSTRAINT productodetalle_cantidad_caja_pro_check CHECK ((cantidad_caja_pro > 0)),
    CONSTRAINT productodetalle_cantidad_uni_pro_check CHECK ((cantidad_uni_pro >= 0)),
    CONSTRAINT productodetalle_costo_caja_pro_check CHECK ((costo_caja_pro >= (0)::numeric)),
    CONSTRAINT productodetalle_costo_uni_pro_check CHECK ((costo_uni_pro >= (0)::numeric)),
    CONSTRAINT productodetalle_uni_caja_pro_check CHECK ((uni_caja_pro > 0))
);


ALTER TABLE public.productodetalle OWNER TO postgres;

--
-- TOC entry 239 (class 1259 OID 33834)
-- Name: productodetalle_id_det_pro_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.productodetalle_id_det_pro_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.productodetalle_id_det_pro_seq OWNER TO postgres;

--
-- TOC entry 5144 (class 0 OID 0)
-- Dependencies: 239
-- Name: productodetalle_id_det_pro_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.productodetalle_id_det_pro_seq OWNED BY public.productodetalle.id_det_pro;


--
-- TOC entry 222 (class 1259 OID 33727)
-- Name: proveedor; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.proveedor (
    id_proveedor integer NOT NULL,
    nombre_prove character varying(100) NOT NULL,
    ruc_prove character varying(30) NOT NULL,
    direccion_prove text NOT NULL,
    telefono_prove character varying(20) NOT NULL
);


ALTER TABLE public.proveedor OWNER TO postgres;

--
-- TOC entry 221 (class 1259 OID 33726)
-- Name: proveedor_id_proveedor_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.proveedor_id_proveedor_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.proveedor_id_proveedor_seq OWNER TO postgres;

--
-- TOC entry 5145 (class 0 OID 0)
-- Dependencies: 221
-- Name: proveedor_id_proveedor_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.proveedor_id_proveedor_seq OWNED BY public.proveedor.id_proveedor;


--
-- TOC entry 230 (class 1259 OID 33761)
-- Name: roles; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.roles (
    id_rol integer NOT NULL,
    descripcion_rol character varying(100) NOT NULL,
    accesos_rol text[] NOT NULL,
    creado_rol date NOT NULL,
    fecha_rol date NOT NULL
);


ALTER TABLE public.roles OWNER TO postgres;

--
-- TOC entry 229 (class 1259 OID 33760)
-- Name: roles_id_rol_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.roles_id_rol_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.roles_id_rol_seq OWNER TO postgres;

--
-- TOC entry 5146 (class 0 OID 0)
-- Dependencies: 229
-- Name: roles_id_rol_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.roles_id_rol_seq OWNED BY public.roles.id_rol;


--
-- TOC entry 244 (class 1259 OID 66756)
-- Name: seq_factura; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.seq_factura
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.seq_factura OWNER TO postgres;

--
-- TOC entry 243 (class 1259 OID 66755)
-- Name: seq_ticket; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.seq_ticket
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.seq_ticket OWNER TO postgres;

--
-- TOC entry 249 (class 1259 OID 83151)
-- Name: ticket_numero_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_numero_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 20;


ALTER SEQUENCE public.ticket_numero_seq OWNER TO postgres;

--
-- TOC entry 252 (class 1259 OID 83154)
-- Name: ticket; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.ticket (
    id_ticket bigint NOT NULL,
    id_venta bigint NOT NULL,
    numero bigint DEFAULT nextval('public.ticket_numero_seq'::regclass) NOT NULL,
    fecha timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.ticket OWNER TO postgres;

--
-- TOC entry 251 (class 1259 OID 83153)
-- Name: ticket_id_ticket_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.ticket_id_ticket_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.ticket_id_ticket_seq OWNER TO postgres;

--
-- TOC entry 5147 (class 0 OID 0)
-- Dependencies: 251
-- Name: ticket_id_ticket_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.ticket_id_ticket_seq OWNED BY public.ticket.id_ticket;


--
-- TOC entry 228 (class 1259 OID 33754)
-- Name: tipocomprovante; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.tipocomprovante (
    id_comprovante integer NOT NULL,
    nombre_comprovante character varying(100) NOT NULL
);


ALTER TABLE public.tipocomprovante OWNER TO postgres;

--
-- TOC entry 227 (class 1259 OID 33753)
-- Name: tipocomprovante_id_comprovante_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.tipocomprovante_id_comprovante_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.tipocomprovante_id_comprovante_seq OWNER TO postgres;

--
-- TOC entry 5148 (class 0 OID 0)
-- Dependencies: 227
-- Name: tipocomprovante_id_comprovante_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.tipocomprovante_id_comprovante_seq OWNED BY public.tipocomprovante.id_comprovante;


--
-- TOC entry 232 (class 1259 OID 33770)
-- Name: usuario; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.usuario (
    id_usu integer NOT NULL,
    nombre_usu character varying(100) NOT NULL,
    clave_usu character varying(255) NOT NULL,
    estado_usu integer DEFAULT 1 NOT NULL,
    fecha_creado_usu date NOT NULL,
    fecha_actualiza_usu date NOT NULL,
    id_rol integer NOT NULL
);


ALTER TABLE public.usuario OWNER TO postgres;

--
-- TOC entry 231 (class 1259 OID 33769)
-- Name: usuario_id_usu_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.usuario_id_usu_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.usuario_id_usu_seq OWNER TO postgres;

--
-- TOC entry 5149 (class 0 OID 0)
-- Dependencies: 231
-- Name: usuario_id_usu_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.usuario_id_usu_seq OWNED BY public.usuario.id_usu;


--
-- TOC entry 246 (class 1259 OID 83109)
-- Name: venta; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.venta (
    id_venta bigint NOT NULL,
    fecha_venta timestamp with time zone DEFAULT now() NOT NULL,
    descuento_venta numeric(14,2) DEFAULT 0.00 NOT NULL,
    total_venta numeric(14,2) DEFAULT 0.00 NOT NULL,
    recibido numeric(14,2) DEFAULT 0.00 NOT NULL,
    vuelto numeric(14,2) DEFAULT 0.00 NOT NULL,
    estado_venta character varying(10) DEFAULT 'CER'::character varying NOT NULL,
    observacion text,
    id_per bigint,
    id_usuario bigint,
    id_comprobante bigint,
    CONSTRAINT venta_chk_montos_no_negativos CHECK (((descuento_venta >= (0)::numeric) AND (total_venta >= (0)::numeric) AND (recibido >= (0)::numeric) AND (vuelto >= (0)::numeric)))
);


ALTER TABLE public.venta OWNER TO postgres;

--
-- TOC entry 248 (class 1259 OID 83129)
-- Name: venta_detalle; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.venta_detalle (
    id_det_venta bigint NOT NULL,
    id_venta bigint NOT NULL,
    id_pro bigint,
    nombre_pro text NOT NULL,
    cantidad numeric(14,2) DEFAULT 0.00 NOT NULL,
    precio_unit numeric(14,2) DEFAULT 0.00 NOT NULL,
    subtotal numeric(14,2) DEFAULT 0.00 NOT NULL,
    iva_porcentaje numeric(5,2) DEFAULT 0.00 NOT NULL,
    iva_monto numeric(14,2) DEFAULT 0.00 NOT NULL,
    descuento numeric(14,2) DEFAULT 0.00 NOT NULL,
    CONSTRAINT detalle_chk_cant_precio CHECK (((cantidad > (0)::numeric) AND (precio_unit >= (0)::numeric) AND (subtotal >= (0)::numeric) AND (descuento >= (0)::numeric) AND (iva_porcentaje >= (0)::numeric) AND (iva_monto >= (0)::numeric)))
);


ALTER TABLE public.venta_detalle OWNER TO postgres;

--
-- TOC entry 247 (class 1259 OID 83128)
-- Name: venta_detalle_id_det_venta_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.venta_detalle_id_det_venta_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.venta_detalle_id_det_venta_seq OWNER TO postgres;

--
-- TOC entry 5150 (class 0 OID 0)
-- Dependencies: 247
-- Name: venta_detalle_id_det_venta_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.venta_detalle_id_det_venta_seq OWNED BY public.venta_detalle.id_det_venta;


--
-- TOC entry 245 (class 1259 OID 83108)
-- Name: venta_id_venta_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.venta_id_venta_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.venta_id_venta_seq OWNER TO postgres;

--
-- TOC entry 5151 (class 0 OID 0)
-- Dependencies: 245
-- Name: venta_id_venta_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.venta_id_venta_seq OWNED BY public.venta.id_venta;


--
-- TOC entry 4828 (class 2604 OID 33714)
-- Name: cargo id_cargo; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cargo ALTER COLUMN id_cargo SET DEFAULT nextval('public.cargo_id_cargo_seq'::regclass);


--
-- TOC entry 4829 (class 2604 OID 33721)
-- Name: categoria id_cat; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.categoria ALTER COLUMN id_cat SET DEFAULT nextval('public.categoria_id_cat_seq'::regclass);


--
-- TOC entry 4839 (class 2604 OID 33802)
-- Name: compra id_com; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.compra ALTER COLUMN id_com SET DEFAULT nextval('public.compra_id_com_seq'::regclass);


--
-- TOC entry 4840 (class 2604 OID 33821)
-- Name: compra_detalle id_comp_det; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.compra_detalle ALTER COLUMN id_comp_det SET DEFAULT nextval('public.compra_detalle_id_comp_det_seq'::regclass);


--
-- TOC entry 4862 (class 2604 OID 83176)
-- Name: factura id_factura; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.factura ALTER COLUMN id_factura SET DEFAULT nextval('public.factura_id_factura_seq'::regclass);


--
-- TOC entry 4831 (class 2604 OID 33741)
-- Name: moneda id_mon; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.moneda ALTER COLUMN id_mon SET DEFAULT nextval('public.moneda_id_mon_seq'::regclass);


--
-- TOC entry 4842 (class 2604 OID 42131)
-- Name: pago_venta id_pago; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pago_venta ALTER COLUMN id_pago SET DEFAULT nextval('public.pago_venta_id_pago_seq'::regclass);


--
-- TOC entry 4832 (class 2604 OID 33748)
-- Name: persona id_per; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.persona ALTER COLUMN id_per SET DEFAULT nextval('public.persona_id_per_seq'::regclass);


--
-- TOC entry 4837 (class 2604 OID 33786)
-- Name: producto id_pro; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.producto ALTER COLUMN id_pro SET DEFAULT nextval('public.producto_id_pro_seq'::regclass);


--
-- TOC entry 4841 (class 2604 OID 33838)
-- Name: productodetalle id_det_pro; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.productodetalle ALTER COLUMN id_det_pro SET DEFAULT nextval('public.productodetalle_id_det_pro_seq'::regclass);


--
-- TOC entry 4830 (class 2604 OID 33730)
-- Name: proveedor id_proveedor; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.proveedor ALTER COLUMN id_proveedor SET DEFAULT nextval('public.proveedor_id_proveedor_seq'::regclass);


--
-- TOC entry 4834 (class 2604 OID 33764)
-- Name: roles id_rol; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.roles ALTER COLUMN id_rol SET DEFAULT nextval('public.roles_id_rol_seq'::regclass);


--
-- TOC entry 4859 (class 2604 OID 83157)
-- Name: ticket id_ticket; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket ALTER COLUMN id_ticket SET DEFAULT nextval('public.ticket_id_ticket_seq'::regclass);


--
-- TOC entry 4833 (class 2604 OID 33757)
-- Name: tipocomprovante id_comprovante; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.tipocomprovante ALTER COLUMN id_comprovante SET DEFAULT nextval('public.tipocomprovante_id_comprovante_seq'::regclass);


--
-- TOC entry 4835 (class 2604 OID 33773)
-- Name: usuario id_usu; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.usuario ALTER COLUMN id_usu SET DEFAULT nextval('public.usuario_id_usu_seq'::regclass);


--
-- TOC entry 4845 (class 2604 OID 83112)
-- Name: venta id_venta; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.venta ALTER COLUMN id_venta SET DEFAULT nextval('public.venta_id_venta_seq'::regclass);


--
-- TOC entry 4852 (class 2604 OID 83132)
-- Name: venta_detalle id_det_venta; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.venta_detalle ALTER COLUMN id_det_venta SET DEFAULT nextval('public.venta_detalle_id_det_venta_seq'::regclass);


--
-- TOC entry 5093 (class 0 OID 33711)
-- Dependencies: 218
-- Data for Name: cargo; Type: TABLE DATA; Schema: public; Owner: postgres
--

--
-- TOC entry 5152 (class 0 OID 0)
-- Dependencies: 217
-- Name: cargo_id_cargo_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.cargo_id_cargo_seq', 3, true);


--
-- TOC entry 5153 (class 0 OID 0)
-- Dependencies: 219
-- Name: categoria_id_cat_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.categoria_id_cat_seq', 3, true);


--
-- TOC entry 5154 (class 0 OID 0)
-- Dependencies: 237
-- Name: compra_detalle_id_comp_det_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.compra_detalle_id_comp_det_seq', 1, false);


--
-- TOC entry 5155 (class 0 OID 0)
-- Dependencies: 235
-- Name: compra_id_com_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.compra_id_com_seq', 1, true);


--
-- TOC entry 5156 (class 0 OID 0)
-- Dependencies: 253
-- Name: factura_id_factura_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.factura_id_factura_seq', 130, true);


--
-- TOC entry 5157 (class 0 OID 0)
-- Dependencies: 250
-- Name: factura_numero_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.factura_numero_seq', 80, true);


--
-- TOC entry 5158 (class 0 OID 0)
-- Dependencies: 223
-- Name: moneda_id_mon_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.moneda_id_mon_seq', 3, true);


--
-- TOC entry 5159 (class 0 OID 0)
-- Dependencies: 241
-- Name: pago_venta_id_pago_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.pago_venta_id_pago_seq', 1, false);


--
-- TOC entry 5160 (class 0 OID 0)
-- Dependencies: 225
-- Name: persona_id_per_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.persona_id_per_seq', 4, true);


--
-- TOC entry 5161 (class 0 OID 0)
-- Dependencies: 233
-- Name: producto_id_pro_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.producto_id_pro_seq', 7, true);


--
-- TOC entry 5162 (class 0 OID 0)
-- Dependencies: 239
-- Name: productodetalle_id_det_pro_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.productodetalle_id_det_pro_seq', 4, true);


--
-- TOC entry 5163 (class 0 OID 0)
-- Dependencies: 221
-- Name: proveedor_id_proveedor_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.proveedor_id_proveedor_seq', 1, true);


--
-- TOC entry 5164 (class 0 OID 0)
-- Dependencies: 229
-- Name: roles_id_rol_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.roles_id_rol_seq', 1, true);


--
-- TOC entry 5165 (class 0 OID 0)
-- Dependencies: 244
-- Name: seq_factura; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.seq_factura', 3, true);


--
-- TOC entry 5166 (class 0 OID 0)
-- Dependencies: 243
-- Name: seq_ticket; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.seq_ticket', 1, true);


--
-- TOC entry 5167 (class 0 OID 0)
-- Dependencies: 251
-- Name: ticket_id_ticket_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.ticket_id_ticket_seq', 131, true);


--
-- TOC entry 5168 (class 0 OID 0)
-- Dependencies: 249
-- Name: ticket_numero_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.ticket_numero_seq', 100, true);


--
-- TOC entry 5169 (class 0 OID 0)
-- Dependencies: 227
-- Name: tipocomprovante_id_comprovante_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.tipocomprovante_id_comprovante_seq', 1, true);


--
-- TOC entry 5170 (class 0 OID 0)
-- Dependencies: 231
-- Name: usuario_id_usu_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.usuario_id_usu_seq', 1, true);


--
-- TOC entry 5171 (class 0 OID 0)
-- Dependencies: 247
-- Name: venta_detalle_id_det_venta_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.venta_detalle_id_det_venta_seq', 399, true);


--
-- TOC entry 5172 (class 0 OID 0)
-- Dependencies: 245
-- Name: venta_id_venta_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.venta_id_venta_seq', 152, true);


--
-- TOC entry 4876 (class 2606 OID 33716)
-- Name: cargo cargo_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cargo
    ADD CONSTRAINT cargo_pkey PRIMARY KEY (id_cargo);


--
-- TOC entry 4878 (class 2606 OID 33725)
-- Name: categoria categoria_nombre_cat_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.categoria
    ADD CONSTRAINT categoria_nombre_cat_key UNIQUE (nombre_cat);


--
-- TOC entry 4880 (class 2606 OID 33723)
-- Name: categoria categoria_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.categoria
    ADD CONSTRAINT categoria_pkey PRIMARY KEY (id_cat);


--
-- TOC entry 4906 (class 2606 OID 33823)
-- Name: compra_detalle compra_detalle_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.compra_detalle
    ADD CONSTRAINT compra_detalle_pkey PRIMARY KEY (id_comp_det);


--
-- TOC entry 4904 (class 2606 OID 33806)
-- Name: compra compra_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.compra
    ADD CONSTRAINT compra_pkey PRIMARY KEY (id_com);


--
-- TOC entry 4929 (class 2606 OID 83182)
-- Name: factura factura_id_venta_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.factura
    ADD CONSTRAINT factura_id_venta_key UNIQUE (id_venta);


--
-- TOC entry 4931 (class 2606 OID 83184)
-- Name: factura factura_numero_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.factura
    ADD CONSTRAINT factura_numero_key UNIQUE (numero);


--
-- TOC entry 4933 (class 2606 OID 83180)
-- Name: factura factura_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.factura
    ADD CONSTRAINT factura_pkey PRIMARY KEY (id_factura);


--
-- TOC entry 4886 (class 2606 OID 33743)
-- Name: moneda moneda_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.moneda
    ADD CONSTRAINT moneda_pkey PRIMARY KEY (id_mon);


--
-- TOC entry 4910 (class 2606 OID 42136)
-- Name: pago_venta pago_venta_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pago_venta
    ADD CONSTRAINT pago_venta_pkey PRIMARY KEY (id_pago);


--
-- TOC entry 4888 (class 2606 OID 33752)
-- Name: persona persona_cedula_per_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.persona
    ADD CONSTRAINT persona_cedula_per_key UNIQUE (cedula_per);


--
-- TOC entry 4890 (class 2606 OID 33750)
-- Name: persona persona_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.persona
    ADD CONSTRAINT persona_pkey PRIMARY KEY (id_per);


--
-- TOC entry 4900 (class 2606 OID 33792)
-- Name: producto producto_codigo_barra_pro_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.producto
    ADD CONSTRAINT producto_codigo_barra_pro_key UNIQUE (codigo_barra_pro);


--
-- TOC entry 4902 (class 2606 OID 33790)
-- Name: producto producto_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.producto
    ADD CONSTRAINT producto_pkey PRIMARY KEY (id_pro);


--
-- TOC entry 4908 (class 2606 OID 33845)
-- Name: productodetalle productodetalle_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.productodetalle
    ADD CONSTRAINT productodetalle_pkey PRIMARY KEY (id_det_pro);


--
-- TOC entry 4882 (class 2606 OID 33734)
-- Name: proveedor proveedor_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.proveedor
    ADD CONSTRAINT proveedor_pkey PRIMARY KEY (id_proveedor);


--
-- TOC entry 4884 (class 2606 OID 33736)
-- Name: proveedor proveedor_ruc_prove_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.proveedor
    ADD CONSTRAINT proveedor_ruc_prove_key UNIQUE (ruc_prove);


--
-- TOC entry 4894 (class 2606 OID 33768)
-- Name: roles roles_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.roles
    ADD CONSTRAINT roles_pkey PRIMARY KEY (id_rol);


--
-- TOC entry 4923 (class 2606 OID 83163)
-- Name: ticket ticket_id_venta_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket
    ADD CONSTRAINT ticket_id_venta_key UNIQUE (id_venta);


--
-- TOC entry 4925 (class 2606 OID 83165)
-- Name: ticket ticket_numero_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket
    ADD CONSTRAINT ticket_numero_key UNIQUE (numero);


--
-- TOC entry 4927 (class 2606 OID 83161)
-- Name: ticket ticket_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket
    ADD CONSTRAINT ticket_pkey PRIMARY KEY (id_ticket);


--
-- TOC entry 4892 (class 2606 OID 33759)
-- Name: tipocomprovante tipocomprovante_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.tipocomprovante
    ADD CONSTRAINT tipocomprovante_pkey PRIMARY KEY (id_comprovante);


--
-- TOC entry 4896 (class 2606 OID 33776)
-- Name: usuario usuario_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.usuario
    ADD CONSTRAINT usuario_pkey PRIMARY KEY (id_usu);


--
-- TOC entry 4920 (class 2606 OID 83143)
-- Name: venta_detalle venta_detalle_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.venta_detalle
    ADD CONSTRAINT venta_detalle_pkey PRIMARY KEY (id_det_venta);


--
-- TOC entry 4916 (class 2606 OID 83123)
-- Name: venta venta_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.venta
    ADD CONSTRAINT venta_pkey PRIMARY KEY (id_venta);


--
-- TOC entry 4917 (class 1259 OID 83150)
-- Name: idx_detalle_idpro; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_detalle_idpro ON public.venta_detalle USING btree (id_pro);


--
-- TOC entry 4918 (class 1259 OID 83149)
-- Name: idx_detalle_idventa; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_detalle_idventa ON public.venta_detalle USING btree (id_venta);


--
-- TOC entry 4934 (class 1259 OID 83190)
-- Name: idx_factura_fecha; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_factura_fecha ON public.factura USING btree (fecha DESC);


--
-- TOC entry 4897 (class 1259 OID 42147)
-- Name: idx_producto_cod; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_producto_cod ON public.producto USING btree (codigo_barra_pro);


--
-- TOC entry 4898 (class 1259 OID 42148)
-- Name: idx_producto_nombre; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_producto_nombre ON public.producto USING btree (nombre_pro);


--
-- TOC entry 4921 (class 1259 OID 83171)
-- Name: idx_ticket_fecha; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_ticket_fecha ON public.ticket USING btree (fecha DESC);


--
-- TOC entry 4911 (class 1259 OID 83127)
-- Name: idx_venta_estado; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_venta_estado ON public.venta USING btree (estado_venta);


--
-- TOC entry 4912 (class 1259 OID 83124)
-- Name: idx_venta_fecha; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_venta_fecha ON public.venta USING btree (fecha_venta DESC);


--
-- TOC entry 4913 (class 1259 OID 83125)
-- Name: idx_venta_id_per; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_venta_id_per ON public.venta USING btree (id_per);


--
-- TOC entry 4914 (class 1259 OID 83126)
-- Name: idx_venta_id_usuario; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_venta_id_usuario ON public.venta USING btree (id_usuario);


--
-- TOC entry 4946 (class 2606 OID 83185)
-- Name: factura factura_id_venta_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.factura
    ADD CONSTRAINT factura_id_venta_fkey FOREIGN KEY (id_venta) REFERENCES public.venta(id_venta) ON DELETE CASCADE;


--
-- TOC entry 4936 (class 2606 OID 33793)
-- Name: producto fk_categoria; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.producto
    ADD CONSTRAINT fk_categoria FOREIGN KEY (id_cat) REFERENCES public.categoria(id_cat) ON DELETE RESTRICT;


--
-- TOC entry 4939 (class 2606 OID 33824)
-- Name: compra_detalle fk_compra; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.compra_detalle
    ADD CONSTRAINT fk_compra FOREIGN KEY (id_com) REFERENCES public.compra(id_com) ON DELETE CASCADE;


--
-- TOC entry 4937 (class 2606 OID 33812)
-- Name: compra fk_moneda; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.compra
    ADD CONSTRAINT fk_moneda FOREIGN KEY (id_mon) REFERENCES public.moneda(id_mon);


--
-- TOC entry 4940 (class 2606 OID 33829)
-- Name: compra_detalle fk_producto; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.compra_detalle
    ADD CONSTRAINT fk_producto FOREIGN KEY (id_pro) REFERENCES public.producto(id_pro) ON DELETE CASCADE;


--
-- TOC entry 4941 (class 2606 OID 33851)
-- Name: productodetalle fk_producto_detalle_com; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.productodetalle
    ADD CONSTRAINT fk_producto_detalle_com FOREIGN KEY (id_com) REFERENCES public.compra(id_com) ON DELETE CASCADE;


--
-- TOC entry 4942 (class 2606 OID 33846)
-- Name: productodetalle fk_producto_detalle_pro; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.productodetalle
    ADD CONSTRAINT fk_producto_detalle_pro FOREIGN KEY (id_pro) REFERENCES public.producto(id_pro) ON DELETE CASCADE;


--
-- TOC entry 4938 (class 2606 OID 33807)
-- Name: compra fk_proveedor; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.compra
    ADD CONSTRAINT fk_proveedor FOREIGN KEY (id_proveedor) REFERENCES public.proveedor(id_proveedor);


--
-- TOC entry 4935 (class 2606 OID 33777)
-- Name: usuario fk_rol; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.usuario
    ADD CONSTRAINT fk_rol FOREIGN KEY (id_rol) REFERENCES public.roles(id_rol) ON DELETE RESTRICT;


--
-- TOC entry 4943 (class 2606 OID 42142)
-- Name: pago_venta pago_venta_id_mon_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pago_venta
    ADD CONSTRAINT pago_venta_id_mon_fkey FOREIGN KEY (id_mon) REFERENCES public.moneda(id_mon);


--
-- TOC entry 4945 (class 2606 OID 83166)
-- Name: ticket ticket_id_venta_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ticket
    ADD CONSTRAINT ticket_id_venta_fkey FOREIGN KEY (id_venta) REFERENCES public.venta(id_venta) ON DELETE CASCADE;


--
-- TOC entry 4944 (class 2606 OID 83144)
-- Name: venta_detalle venta_detalle_id_venta_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.venta_detalle
    ADD CONSTRAINT venta_detalle_id_venta_fkey FOREIGN KEY (id_venta) REFERENCES public.venta(id_venta) ON DELETE CASCADE;


-- Completed on 2025-12-09 13:55:34

--
-- PostgreSQL database dump complete
--

